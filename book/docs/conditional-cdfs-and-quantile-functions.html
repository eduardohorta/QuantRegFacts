<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.2 Conditional CDFs and Quantile functions | Quantile Regression: Facts and digressions</title>
  <meta name="description" content="Some facts about Quantile Regression." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3.2 Conditional CDFs and Quantile functions | Quantile Regression: Facts and digressions" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Some facts about Quantile Regression." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.2 Conditional CDFs and Quantile functions | Quantile Regression: Facts and digressions" />
  
  <meta name="twitter:description" content="Some facts about Quantile Regression." />
  



<meta name="date" content="2021-06-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-substitution-principle.html"/>
<link rel="next" href="conditional-expectation.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Exordium</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Intro: distributions and quantiles</a>
<ul>
<li class="chapter" data-level="2.1" data-path="quantiles-and-ranks.html"><a href="quantiles-and-ranks.html"><i class="fa fa-check"></i><b>2.1</b> Quantiles and ranks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="conditioning-the-plot-thickens.html"><a href="conditioning-the-plot-thickens.html"><i class="fa fa-check"></i><b>3</b> Conditioning: the plot thickens</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-substitution-principle.html"><a href="the-substitution-principle.html"><i class="fa fa-check"></i><b>3.1</b> The Substitution Principle</a></li>
<li class="chapter" data-level="3.2" data-path="conditional-cdfs-and-quantile-functions.html"><a href="conditional-cdfs-and-quantile-functions.html"><i class="fa fa-check"></i><b>3.2</b> Conditional CDFs and Quantile functions</a></li>
<li class="chapter" data-level="3.3" data-path="conditional-expectation.html"><a href="conditional-expectation.html"><i class="fa fa-check"></i><b>3.3</b> Conditional Expectation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="quantile-regression.html"><a href="quantile-regression.html"><i class="fa fa-check"></i><b>4</b> Quantile Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="drawbacks.html"><a href="drawbacks.html"><i class="fa fa-check"></i><b>4.1</b> Drawbacks</a></li>
<li class="chapter" data-level="4.2" data-path="quantile-regression-via-a-family-of-hyperplanes.html"><a href="quantile-regression-via-a-family-of-hyperplanes.html"><i class="fa fa-check"></i><b>4.2</b> Quantile regression via a family of hyperplanes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="quantile-regression-in-time-series.html"><a href="quantile-regression-in-time-series.html"><i class="fa fa-check"></i><b>5</b> Quantile regression in time series</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-dynamic-quantile-regression-models.html"><a href="linear-dynamic-quantile-regression-models.html"><i class="fa fa-check"></i><b>5.1</b> Linear dynamic quantile regression models</a></li>
<li class="chapter" data-level="5.2" data-path="affine-hyperplanes-again.html"><a href="affine-hyperplanes-again.html"><i class="fa fa-check"></i><b>5.2</b> Affine hyperplanes, again</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantile Regression: Facts and digressions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="conditional-cdfs-and-quantile-functions" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Conditional CDFs and Quantile functions</h2>
<p>In section <a href="intro.html#intro">2</a> we have put forth the case that univariate probability distributions are essentially the same thing as their corresponding cumulative distribution functions, which in turn are essentially the same thing as their quantile functions. Well, whenever <span class="math inline">\(Y\)</span> is a scalar random variable (and <span class="math inline">\(X\)</span> is a random vector), for a fixed <span class="math inline">\(x\in\mathbb{R}^{\mathrm{D}_X}\)</span> the real valued function
<span class="math display" id="eq:cond-distr-local-use">\[\begin{equation}
B\mapsto \mathbf{P}[Y\in B\,|\, X=x]
\tag{3.3}
\end{equation}\]</span>
is in fact a probability distribution on the Borel subsets of <span class="math inline">\(\mathbb{R}.\)</span> Thus, it not only makes sense to define the corresponding cumulative distribution function, but it is also the case that the latter function fully characterizes the mapping in equation <a href="conditional-cdfs-and-quantile-functions.html#eq:cond-distr-local-use">(3.3)</a>. The <em>conditional cumulative distribution of <span class="math inline">\(Y\)</span> given <span class="math inline">\(X\)</span></em> is the function <span class="math inline">\((y,x)\mapsto F_{Y|X}(y|x)\)</span> defined on <span class="math inline">\(\mathbb{R}\times\mathbb{R}^{\mathrm{D}_X}\)</span> by
<span class="math display">\[\begin{equation}
F_{Y|X}(y|x) := \mathbf{P}[Y\le y\,|\,X=x].
\end{equation}\]</span>
Importantly, the machinery introduced so far allows us to write the joint cumulative distribution function of <span class="math inline">\((Y,X)\)</span> as<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>
<span class="math display" id="eq:LTP-CDF">\[\begin{equation}
F_{Y,X}(y,x) = \int_{-\infty}^x F_{Y|X}(y|u)\,F_X(\mathrm{d}u),\quad y\in\mathbb{R}, x\in\mathbb{R}^{\mathrm{D}_X}.
\tag{3.4}
\end{equation}\]</span></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-15" class="exercise"><strong>Exercise 3.2  </strong></span>Find an expression for <span class="math inline">\(F_{Y|X}(y|x)\)</span>:</p>
<ol style="list-style-type: decimal">
<li>in terms of the joint density function <span class="math inline">\(f_{Y,X},\)</span> assuming <span class="math inline">\((Y,X)\)</span> is absolutely continuous.</li>
<li>in terms of the joint mass function <span class="math inline">\(p_{Y,X},\)</span> assuming <span class="math inline">\((Y,X)\)</span> is discrete. <span class="math inline">\(\blacksquare\)</span></li>
</ol>
</div>
<p><strong>But this is a text about quantile regression</strong>, and now comes a fundamental definition in this direction: in the same setting as above, we let the <em>conditional quantile function of <span class="math inline">\(Y\)</span> given <span class="math inline">\(X\)</span></em> be the function <span class="math inline">\((\tau,x)\mapsto Q_{Y|X}(\tau|x)\)</span> defined on <span class="math inline">\((0,1)\times\mathbb{R}^{\mathrm{D}_X}\)</span> by
<span class="math display">\[\begin{equation}
Q_{Y|X}(\tau|x) = \inf\{y\in\mathbb{R}\colon\, F_{Y|X}(y|x)\ge\tau\}.
\end{equation}\]</span>
Wrapping up what we have seen so far, the catch is that a probability distribution on <span class="math inline">\(\mathbb{R}\times\mathbb{R}^{\mathrm{D}_X}\)</span> is entirely determined by the marginal distribution of <span class="math inline">\(X\)</span> together with the conditional quantile function <span class="math inline">\(Q_{Y|X},\)</span> since we can recover the conditional CDF <span class="math inline">\(F_{Y|X}\)</span> from <span class="math inline">\(Q_{Y|X}\)</span> and reconstruct the joint CDF <span class="math inline">\(F_{Y,X}\)</span> via <a href="conditional-cdfs-and-quantile-functions.html#eq:LTP-CDF">(3.4)</a>. From <span class="math inline">\(F_{Y,X}\)</span> we can then compute the probability of any event of the form <span class="math inline">\([Y\in B, X\in A ]\)</span> via the formula
<span class="math display">\[
\mathbf{P}[Y\in B, X\in A] = \int_{B\times A}\,F_{X,Y}(\mathrm{d}y, \mathrm{d}x).
\]</span></p>
<p>The idea is not a mere shenanigan: for instance, if <span class="math inline">\({\mathrm{D}_X}=1\)</span> it provides us a recipe to simulate a pair <span class="math inline">\((Y,X)\)</span> from the distribution <span class="math inline">\(\mathbf{P}_{Y,X}\)</span> as follows:</p>
<ol style="list-style-type: decimal">
<li>generate two independent pseudo-random numbers <span class="math inline">\(u_1\)</span> and <span class="math inline">\(u_2\)</span> from the Uniform<span class="math inline">\([0,1]\)</span> distribution.</li>
<li>set <span class="math inline">\(x = Q_X(u_1)\)</span> and <span class="math inline">\(y = Q_{Y|X}(u_2|x).\)</span></li>
</ol>
<p>It follows that the pair <span class="math inline">\((y,x)\)</span> is a pseudo-random draw from <span class="math inline">\(\mathbf{P}_{Y,X}.\)</span></p>

<div class="theorem">
<p><span id="thm:Fund-Thm-Sim-2" class="theorem"><strong>Theorem 3.3  </strong></span>Assume <span class="math inline">\(Y\)</span> is a scalar random variable, and <span class="math inline">\(X\)</span> is a <span class="math inline">\({\mathrm{D}_X}\)</span>-dimensional random vector. Denote by <span class="math inline">\(F_X\)</span> the cumulative distribution function of <span class="math inline">\(X,\)</span> and by <span class="math inline">\(Q_{Y|X}\)</span> the conditional quantile function of <span class="math inline">\(Y\)</span> given <span class="math inline">\(X.\)</span> Now let <span class="math inline">\(U\)</span> be a Uniform<span class="math inline">\([0,1]\)</span> random variable independent from <span class="math inline">\(X,\)</span> and define <span class="math inline">\(\tilde{Y} = Q_{Y|X}(U\,|\,X).\)</span> Then <span class="math inline">\(\tilde{Y} \overset{\textsf{dist}}= Y.\)</span></p>
</div>

<div class="exercise">
<p><span id="exr:unnamed-chunk-16" class="exercise"><strong>Exercise 3.3  </strong></span>Prove Theorem <a href="conditional-cdfs-and-quantile-functions.html#thm:Fund-Thm-Sim-2">3.3</a>. Hint: the bulk of the proof lies in computing <span class="math inline">\(\mathbf{P}[Q_{Y|X}(U|x)\le y\,|\,X=x]\)</span> and then integrating wrt <span class="math inline">\(F_X(\mathrm{d}x).\)</span> For those with a Measure Theoretic eye, however, the question of whether the function <span class="math inline">\(\tilde{Y}\colon\Omega\to\mathbb{R}\)</span> is measurable may be a deterrent; fortunately, the answer to this question is affirmative — see Theorem 3 in <span class="citation"><a href="references.html#ref-Gowrisankaran1972" role="doc-biblioref">Gowrisankaran</a> (<a href="references.html#ref-Gowrisankaran1972" role="doc-biblioref">1972</a>)</span>.</p>
</div>

<div class="exercise">
<p><span id="exr:unnamed-chunk-17" class="exercise"><strong>Exercise 3.4  </strong></span>Let <span class="math inline">\(Z := g(X) + h(X)Y\)</span> where <span class="math inline">\(g\)</span> and <span class="math inline">\(h\)</span> are real valued measurable functions on <span class="math inline">\(\mathbb{R}^{\mathrm{D}_X},\)</span> <span class="math inline">\(h\)</span> being non-negative. Show that <span class="math inline">\(Q_{Z|X}(\tau|x) = g(x) + h(x)Q_{Y|X}(\tau|x),\)</span> for <span class="math inline">\(\tau\in(0,1).\)</span></p>
</div>

<div class="exercise">
<p><span id="exr:unnamed-chunk-18" class="exercise"><strong>Exercise 3.5  </strong></span>For <span class="math inline">\(\tau\in(0,1),\)</span> let <span class="math inline">\(g_\tau\colon\mathbb{R}^{\mathrm{D}_X}\to\mathbb{R}\)</span> be a measurable function.</p>
<ol style="list-style-type: decimal">
<li>Show that
<span class="math display">\[\begin{equation}
\mathbf{E}\rho_\tau\big(Y - Q_{Y|X}(\tau|x)\big) \le \mathbf{E}\rho_\tau\big(Y - g_\tau(X)\big).
\end{equation}\]</span></li>
<li>Show that, if the mapping <span class="math inline">\((\tau,x)\mapsto g_\tau(x)\)</span> is measurable, then
<span class="math display">\[\begin{equation}
\int_0^1\mathbf{E}\rho_\tau\big(Y - Q_{Y|X}(\tau|x)\big)\,\mathrm{d}\tau \le \int_0^1\mathbf{E}\rho_\tau\big(Y - g_\tau(X)\big)\,\mathrm{d}\tau.
\end{equation}\]</span></li>
</ol>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>Of course, the integral can be simplified in the cases where <span class="math inline">\(X\)</span> is discrete or continuous, as we discussed earlier.<a href="conditional-cdfs-and-quantile-functions.html#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-substitution-principle.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conditional-expectation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
